<style>
  .main-layout {
    display: flex;
    flex-direction: row;
    gap: 16px;
    width: 100%;
    height: 100%;
  }
  .stats-panel {
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 8px;
    min-width: 180px;
  }
  .stat-row {
    display: flex;
    align-items: baseline;
    gap: 4px;
  }
  .chart-panel {
    flex: 1;
    display: flex;
    flex-direction: column;
  }
  .chart-container {
    width: 100%;
    height: 140px;
  }
</style>

<div class="view">
  <div class="main-layout">

    <!-- Left: Stats panel -->
    <div class="stats-panel">
      <span class="title title--large">{{ cat_name }}</span>

      <div class="stat-row">
        <span class="value value-large value--tnums">{{ weight.average }}</span>
        <span class="label">lbs</span>
        {% if weight.trend == "gaining" %}
          <span class="label label--small label--outline">↑ {{ weight.change | abs }}</span>
        {% elsif weight.trend == "losing" %}
          <span class="label label--small label--outline">↓ {{ weight.change | abs }}</span>
        {% else %}
          <span class="label label--small label--outline">→</span>
        {% endif %}
      </div>

      <div class="stat-row">
        <span class="value value-large value--tnums">{{ visits_per_day }}</span>
        <span class="label label--small">visits/day</span>
      </div>

      <div class="stat-row">
        <span class="value value--tnums">{{ total_visits }}</span>
        <span class="label label--small">total visits</span>
      </div>
    </div>

    <!-- Right: Chart -->
    <div class="chart-panel">
      <span class="label label--small label--underline">Visits per day</span>
      <div id="visits-chart" class="chart-container"></div>
    </div>

  </div>

  <!-- Title bar -->
  <div class="title_bar">
    <span class="title">{{ date_range.display }}</span>
    <span class="instance">{{ robot_name }}</span>
  </div>
</div>

<script src="https://usetrmnl.com/js/highcharts/12.3.0/highcharts.js"></script>
<script src="https://usetrmnl.com/js/chartkick/5.0.1/chartkick.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  var chartOptions = {
    adapter: "highcharts",
    colors: ["#000000"],
    library: {
      chart: {
        animation: false,
        backgroundColor: 'transparent',
        style: { fontFamily: 'inherit' },
        spacing: [5, 0, 5, 0]
      },
      title: { text: null },
      legend: { enabled: false },
      xAxis: {
        lineColor: '#000',
        tickColor: '#000',
        labels: { style: { color: '#000', fontSize: '9px' } }
      },
      yAxis: {
        title: { text: null },
        gridLineColor: '#ccc',
        gridLineDashStyle: 'Dash',
        labels: { style: { color: '#000', fontSize: '9px' } },
        allowDecimals: false
      },
      plotOptions: {
        series: { animation: false, enableMouseTracking: false },
        column: { borderColor: '#000', borderWidth: 1 }
      },
      credits: { enabled: false },
      tooltip: { enabled: false }
    }
  };

  var visitsData = [
    {% for day in chart_data %}
      ["{{ day.display }}", {{ day.count }}]{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ];

  new Chartkick.ColumnChart("visits-chart", visitsData, chartOptions);
});
</script>
